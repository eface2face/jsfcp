/*
 * JsFCP v0.1.8
 * JavaScript BFCP client implementation using WebSocket as transport and JSON as message format
 * Copyright 2013-2015 eFace2Face, inc. All Rights Reserved
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.JsFCP=e()}}(function(){return function e(t,_,r){function n(o,A){if(!_[o]){if(!t[o]){var s="function"==typeof require&&require;if(!A&&s)return s(o,!0);if(T)return T(o,!0);var i=new Error("Cannot find module '"+o+"'");throw i.code="MODULE_NOT_FOUND",i}var R=_[o]={exports:{}};t[o][0].call(R.exports,function(e){var _=t[o][1][e];return n(_?_:e)},R,R.exports,e,t,_,r)}return _[o].exports}for(var T="function"==typeof require&&require,o=0;o<r.length;o++)n(r[o]);return n}({1:[function(e,t){t.exports={InvalidMessageFormatPrimitive:function(){var e=function(e){this.code=101,this.name="INVALID_MESSAGE_FORMAT_PRIMITIVE",this.message=" Message format error. Primitive doesn't exist. "+e};return e.prototype=new Error,e}(),InvalidMessageFormat:function(){var e=function(e){this.code=102,this.name="INVALID_MESSAGE_FORMAT",this.message=e};return e.prototype=new Error,e}(),InvalidHeaderFormat:function(){var e=function(e){this.code=103,this.name="INVALID_HEADER_FORMAT",this.message=e};return e.prototype=new Error,e}(),NoWebSocketException:function(){var e=function(){this.code=200,this.name="NO_WEBSOCKET_EXCEPTION",this.message="There is no WebSocket available"};return e.prototype=new Error,e}()}},{}],2:[function(e,t){function _(e){T.call(this),this.arrayFloorIds=e}t.exports=_;var r=e("debug")("JsFCP:FloorQuery"),n=e("util"),T=e("events").EventEmitter,o=e("./MessageFactory");n.inherits(_,T),_.prototype.onMessageReceived=function(e){if(e[o.C.HD_PRIMITIVE]===o.C.PRI_FL_STATUS_NAM){var t=e[o.C.HD_ATTRIBUTES],_=t[o.C.ATT_FL_ID_NAM];if(t[o.C.ATT_FLOOR_REQUEST_INFORMATION_NAM]){var n,T,A;for(n=t[o.C.ATT_FLOOR_REQUEST_INFORMATION_NAM].length,T=0;n>T;T++)if(A=t[o.C.ATT_FLOOR_REQUEST_INFORMATION_NAM][T],A[o.C.ATT_OVERALL_REQUEST_STATUS_NAM]){var s=A[o.C.ATT_FL_REQUEST_ID_NAM],i=A[o.C.ATT_OVERALL_REQUEST_STATUS_NAM][o.C.ATT_REQUEST_STATUS_NAM];if(i&&i[o.C.ATT_REQUEST_STATUS_VALUE_NAM]){var R=i[o.C.ATT_REQUEST_STATUS_VALUE_NAM];if(A[o.C.ATT_BENEFICIARY_INFORMATION_NAM]){var E=A[o.C.ATT_BENEFICIARY_INFORMATION_NAM][o.C.ATT_BENEFICIARY_ID_NAM];R===o.C.RS_GRANTED_NAM?this.emit("floorGranted",{floorId:_,beneficiaryId:E,floorRequestId:s}):(R===o.C.RS_RELEASED_NAM||R===o.C.RS_REVOKED_NAM)&&this.emit("floorReleased",{floorId:_,beneficiaryId:E,floorRequestId:s})}}}}}else r("onMessageReceived(): FloorStatus was expected");return null},_.prototype.onErrorReceived=function(e){r("onErrorReceived(): "+e)}},{"./MessageFactory":6,debug:14,events:9,util:13}],3:[function(e,t){function _(e,t,_){this.beneficiaryId=_,this.floorRequestId=t,this.onError=e.error}t.exports=_;var r=e("debug")("JsFCP:FloorRelease"),n=e("./MessageFactory");_.prototype.onMessageReceived=function(e){r("onMessageReceived(): this function shouldn't be called, but was called with: "+e)},_.prototype.onErrorReceived=function(e){r("onErrorReceived(): ",e);var t=e[n.C.HD_ATTRIBUTES][n.C.ATT_ERROR_CODE_NAM],_=e[n.C.HD_ATTRIBUTES][n.C.ATT_ERROR_INFO_NAM];void 0!==this.onError&&this.onError({errorCode:t,errorInfo:_})}},{"./MessageFactory":6,debug:14}],4:[function(e,t){function _(e,t){this.beneficiaryId=t,this.queuePosition=null,this.status=null,this.floorRequestId=null,this.statusInfo=null,this.onPending=e.pending,this.onAccepted=e.accepted,this.onGranted=e.granted,this.onDenied=e.denied,this.onCancelled=e.cancelled,this.onReleased=e.released,this.onRevoked=e.revoked,this.onError=e.error}function r(e,t){return null===e?!1:null===t?!0:t===e?!1:e===T.C.RS_GRANTED_NAM||e===T.C.RS_DENIED_NAM||e===T.C.RS_CANCELLED_NAM||e===T.C.RS_RELEASED_NAM||e===T.C.RS_REVOKED_NAM?!0:t===T.C.RS_GRANTED_NAM?!1:t===T.C.RS_PENDING_NAM&&e===T.C.RS_ACCEPTED_NAM?!0:t===T.C.RS_ACCEPTED_NAM?!1:void 0}t.exports=_;var n=e("debug")("JsFCP:FloorRequest"),T=e("./MessageFactory");_.prototype.onMessageReceived=function(e){if(e[T.C.HD_PRIMITIVE]===T.C.PRI_FL_REQUEST_STATUS_NAM){var t=e[T.C.HD_ATTRIBUTES][T.C.ATT_FLOOR_REQUEST_INFORMATION_NAM],_=e[T.C.HD_ATTRIBUTES][T.C.ATT_STATUS_INFO_NAM];if(t[T.C.ATT_OVERALL_REQUEST_STATUS_NAM]){var o=t[T.C.ATT_OVERALL_REQUEST_STATUS_NAM][T.C.ATT_REQUEST_STATUS_NAM];if(o){var A=o[T.C.ATT_REQUEST_STATUS_VALUE_NAM];if(A&&r(A,this.status)){if(_&&(this.statusInfo=_),this.status=o[T.C.ATT_REQUEST_STATUS_VALUE_NAM],o[T.C.ATT_QUEUE_POSITION_NAM]&&(this.queuePosition=o[T.C.ATT_QUEUE_POSITION_NAM]),this.floorRequestId=t[T.C.ATT_FL_REQUEST_ID_NAM],this.status===T.C.RS_PENDING_NAM)return n("onMessageReceived(): onPending ",this.floorRequestId),this.onPending(this),!0;if(this.status===T.C.RS_ACCEPTED_NAM)return n("onMessageReceived(): onAccepted ",this.floorRequestId),this.onAccepted(this),!0;if(this.status===T.C.RS_GRANTED_NAM)return n("onMessageReceived(): onGranted ",this.floorRequestId),this.onGranted(this),!0;if(this.status===T.C.RS_DENIED_NAM)return n("onMessageReceived(): onDenied ",this.floorRequestId),this.onDenied(),!1;if(this.status===T.C.RS_CANCELLED_NAM)return n("onMessageReceived(): onCancelled ",this.floorRequestId),this.onCancelled(),!1;if(this.status===T.C.RS_RELEASED_NAM)return n("onMessageReceived(): onReleased ",this.floorRequestId),this.onReleased(),!1;if(this.status===T.C.RS_REVOKED_NAM)return n("onMessageReceived(): onRevoked ",this.floorRequestId),this.onRevoked(),!1}}}}else n("onMessageReceived(): FloorRequestStatus was expected");return null},_.prototype.onErrorReceived=function(e){n("onErrorReceived(): "+e);var t=e[T.C.HD_ATTRIBUTES][T.C.ATT_ERROR_CODE_NAM],_=e[T.C.HD_ATTRIBUTES][T.C.ATT_ERROR_INFO_NAM];void 0!==this.onError&&this.onError({errorCode:t,errorInfo:_})}},{"./MessageFactory":6,debug:14}],5:[function(e,t){var _={Participant:e("./Participant"),Exceptions:e("./Exceptions"),debug:e("debug")};t.exports=_},{"./Exceptions":1,"./Participant":7,debug:14}],6:[function(e,t){function _(e,t){this.conferenceId=t,this.userId=e}function r(e,t,_){var E,a,I,c=[],u=_;if(o(e)&&(c=T(t),I=u.length,u=n(c,M[e],u),u.length!==I))return u;switch(e){case N.ATT_PRIORITY_NAM:A(t)||(a="checkJsfcpAttributeFormat(): attribute "+N.ATT_PRIORITY_NAM+', "'+t+'" is not a valid value',R(a),u.push(a));break;case N.ATT_REQUEST_STATUS_NAM:var S=t[N.ATT_REQUEST_STATUS_VALUE_NAM];S&&"undefined"!==S||(a="checkJsfcpAttributeFormat(): attribute "+N.ATT_REQUEST_STATUS_NAM+", "+N.ATT_REQUEST_STATUS_VALUE_NAM+" was found",R(a),u.push(a)),s(S)||(a="checkJsfcpAttributeFormat(): attribute "+N.ATT_REQUEST_STATUS_NAM+', "'+S+'" is not a valid value',R(a),u.push(a));break;case N.ATT_ERROR_CODE_NAM:i(t)||(a="checkJsfcpAttributeFormat(): attribute "+N.ATT_ERROR_CODE_NAM+', "'+t+'" is not a valid value for attribute '+N.ATT_ERROR_CODE_NAM,R(a),u.push(a));break;case N.ATT_FLOOR_REQUEST_INFORMATION_NAM:E=c.indexOf(N.ATT_FL_REQUEST_ID_NAM),0>E&&(a="checkJsfcpAttributeFormat(): Attribute "+N.ATT_FLOOR_REQUEST_INFORMATION_NAM+", no "+N.ATT_FL_REQUEST_ID_NAM+" was found",R(a),u.push(a)),c.indexOf(N.ATT_FL_REQUEST_STATUS_NAM)<0?(a="checkJsfcpAttributeFormat(): attribute "+N.ATT_FLOOR_REQUEST_INFORMATION_NAM+", no "+N.ATT_FL_REQUEST_STATUS_NAM+" was found",R(a),u.push(a)):t[N.ATT_FL_REQUEST_STATUS_NAM]instanceof Array||(a="checkJsfcpAttributeFormat(): attribute "+N.ATT_FLOOR_REQUEST_INFORMATION_NAM+", "+N.ATT_FL_REQUEST_STATUS_NAM+" should be an array",R(a),u.push(a));break;case N.ATT_OVERALL_REQUEST_STATUS_NAM:E=c.indexOf(N.ATT_FL_REQUEST_ID_NAM),0>E&&(a="checkJsfcpAttributeFormat(): attribute "+N.ATT_OVERALL_REQUEST_STATUS_NAM+", no "+N.ATT_FL_REQUEST_ID_NAM+" was found",R(a),u.push(a));break;case N.ATT_FL_REQUEST_STATUS_NAM:E=c.indexOf(N.ATT_FL_ID_NAM),0>E&&(a="checkJsfcpAttributeFormat(): attribute "+N.ATT_FL_REQUEST_STATUS_NAM+", no "+N.ATT_FL_ID_NAM+" was found",R(a),u.push(a));break;case N.ATT_BENEFICIARY_INFORMATION_NAM:E=c.indexOf(N.ATT_BENEFICIARY_ID_NAM),0>E&&(a="checkJsfcpAttributeFormat(): attribute "+N.ATT_BENEFICIARY_INFORMATION_NAM+", no "+N.ATT_BENEFICIARY_ID_NAM+" was found",R(a),u.push(a));break;case N.ATT_REQUESTED_BY_INFORMATION_NAM:E=c.indexOf(N.ATT_REQUESTED_BY_ID_NAM),0>E&&(a="checkJsfcpAttributeFormat(): attribute "+N.ATT_REQUESTED_BY_INFORMATION_NAM+", no "+N.ATT_REQUESTED_BY_ID_NAM+" was found",R(a),u.push(a))}return I=u.length,c.forEach(function(e){if(o(e)||e===N.ATT_PRIORITY_NAM)if(t[e]instanceof Array)for(var _=t[e].length,n=0;_>n;n++)u=r(e,t[e][n],u);else if(u=r(e,t[e],u),u.length!==I)return u}),u}function n(e,t,_){for(var r,n=e.length,T=_,o=0;n>o;o++){var A=t.indexOf(e[o]);0>A&&(r="checkValidAttributes(): attribute list ["+e+"], invalid attribute list because of ["+e[o]+"]",R(r),T.push(r))}return T}function T(e){var t=[];for(var _ in e)t.push(_);return t}function o(e){return M[e]?!0:!1}function A(e){return I.indexOf(e)>=0?!0:!1}function s(e){return c.indexOf(e)>=0?!0:!1}function i(e){return u.indexOf(e)>=0?!0:!1}t.exports=_;var R=e("debug")("JsFCP:MessageFactory"),E=e("./Exceptions"),N={CNF_OPTIONAL:"optional",CNF_MULTI:"multiple",HD_VER:"ver",HD_VER_1:1,HD_PRIMITIVE:"primitive",HD_CONFERENCE_ID:"conferenceId",HD_TRANSACTION_ID:"transactionId",HD_USER_ID:"userId",HD_HEADER:"header",HD_ATTRIBUTES:"attributes",PRI_FL_REQUEST_NAM:"FloorRequest",PRI_FL_REQUEST_VAL:1,PRI_FL_RELEASE_NAM:"FloorRelease",PRI_FL_RELEASE_VAL:2,PRI_FL_REQUEST_QUERY_NAM:"FloorRequestQuery",PRI_FL_REQUEST_QUERY_VAL:3,PRI_FL_REQUEST_STATUS_NAM:"FloorRequestStatus",PRI_FL_REQUEST_STATUS_VAL:4,PRI_FL_USER_QUERY_NAM:"UserQuery",PRI_FL_USER_QUERY_VAL:5,PRI_FL_USER_STATUS_NAM:"UserStatus",PRI_FL_USER_STATUS_VAL:6,PRI_FL_QUERY_NAM:"FloorQuery",PRI_FL_QUERY_VAL:7,PRI_FL_STATUS_NAM:"FloorStatus",PRI_FL_STATUS_VAL:8,PRI_CH_ACTION_NAM:"ChairAction",PRI_CH_ACTION_VAL:9,PRI_CH_ACTION_ACK_NAM:"ChairActionAck",PRI_CH_ACTION_ACK_VAL:10,PRI_HELLO_NAM:"Hello",PRI_HELLO_VAL:11,PRI_HELLO_ACK_NAM:"HelloAck",PRI_HELLO_ACK_VAL:12,PRI_ERROR_NAM:"Error",PRI_ERROR_VAL:13,ATT_BENEFICIARY_ID_NAM:"beneficiaryId",ATT_BENEFICIARY_ID_VAL:1,ATT_FL_ID_NAM:"floorId",ATT_FL_ID_VAL:2,ATT_FL_REQUEST_ID_NAM:"floorRequestId",ATT_FL_REQUEST_ID_VAL:3,ATT_PRIORITY_NAM:"priority",ATT_PRIORITY_VAL:4,ATT_REQUEST_STATUS_NAM:"requestStatus",ATT_REQUEST_STATUS_VAL:5,ATT_ERROR_CODE_NAM:"errorCode",ATT_ERROR_CODE_VAL:6,ATT_ERROR_INFO_NAM:"errorInfo",ATT_ERROR_INFO_VAL:7,ATT_PARTICIPANT_PROVIDED_INFO_NAM:"participantProvidedInfo",ATT_PARTICIPANT_PROVIDED_INFO_VAL:8,ATT_STATUS_INFO_NAM:"statusInfo",ATT_STATUS_INFO_VAL:9,ATT_SUPPORTED_ATTRIBUTES_NAM:"supportedAttributes",ATT_SUPPORTED_ATTRIBUTES_VAL:10,ATT_SUPPORTED_PRIMITIVES_NAM:"supportedPrimitives",ATT_SUPPORTED_PRIMITIVES_VAL:11,ATT_USER_DISPLAY_NAME_NAM:"userDisplayName",ATT_USER_DISPLAY_NAME_VAL:12,ATT_USER_URI_NAM:"userUri",ATT_USER_URI_VAL:13,ATT_BENEFICIARY_INFORMATION_NAM:"beneficiaryInformation",ATT_BENEFICIARY_INFORMATION_VAL:14,ATT_FLOOR_REQUEST_INFORMATION_NAM:"floorRequestInformation",ATT_FLOOR_REQUEST_INFORMATION_VAL:15,ATT_REQUESTED_BY_INFORMATION_NAM:"requestedByInformation",ATT_REQUESTED_BY_INFORMATION_VAL:16,ATT_FL_REQUEST_STATUS_NAM:"floorRequestStatus",ATT_FL_REQUEST_STATUS_VAL:17,ATT_OVERALL_REQUEST_STATUS_NAM:"overallRequestStatus",ATT_OVERALL_REQUEST_STATUS_VAL:18,ATT_REQUESTED_BY_ID_NAM:"requestedById",ATT_REQUESTED_BY_ID_VAL:19,ATT_EXTENSION_ATTRIBUTE_NAM:"extensionAttribute",ATT_EXTENSION_ATTRIBUTE_VAL:20,ATT_REQUEST_STATUS_VALUE_NAM:"status",ATT_REQUEST_STATUS_VALUE_VAL:21,ATT_QUEUE_POSITION_NAM:"queuePosition",ATT_QUEUE_POSITION_VAL:22,ATT_SUPPORTED_FLOORTYPES_NAM:"supportedFloorTypes",ATT_SUPPORTED_FLOORTYPES_VAL:23,PR_LOWEST_NAM:"Lowest",PR_LOWEST_VAL:0,PR_LOW_NAM:"Low",PR_LOW_VAL:1,PR_NORMAL_NAM:"Normal",PR_NORMAL_VAL:2,PR_HIGH_NAM:"High",PR_HIGH_VAL:3,PR_HIGHEST_NAM:"Highest",PR_HIGHEST_VAL:4,RS_PENDING_NAM:"Pending",RS_PENDING_VAL:1,RS_ACCEPTED_NAM:"Accepted",RS_ACCEPTED_VAL:2,RS_GRANTED_NAM:"Granted",RS_GRANTED_VAL:3,RS_DENIED_NAM:"Denied",RS_DENIED_VAL:4,RS_CANCELLED_NAM:"Cancelled",RS_CANCELLED_VAL:5,RS_RELEASED_NAM:"Released",RS_RELEASED_VAL:6,RS_REVOKED_NAM:"Revoked",RS_REVOKED_VAL:7,ERR_NO_CONF_NAM:"ErrorConferenceDoesNotExist",ERR_NO_CONF_VAL:1,ERR_NO_USER_NAM:"UserDoesNotExist",ERR_NO_USER_VAL:2,ERR_UNK_PR_NAM:"UnknownPrimitive",ERR_UNK_PR_VAL:3,ERR_UNK_ATT_NAM:"UnknownMandatoryAttribute",ERR_UNK_ATT_VAL:4,ERR_UNAUTH_OP_NAM:"UnauthorizedOperation",ERR_UNAUTH_OP_VAL:5,ERR_INV_FL_ID_NAM:"InvalidFloorId",ERR_INV_FL_ID_VAL:6,ERR_NO_FL_RQ_ID_NAM:"FloorRequestIdDoesNotExist",ERR_NO_FL_RQ_ID_VAL:7,ERR_MAX_FL_RQ_NAM:"FloorRequestMaxNumberReached",ERR_MAX_FL_RQ_VAL:8,ERR_TLS_NAM:"UseTls",ERR_TLS_VAL:9};_.C=N;var a=[N.PRI_FL_REQUEST_NAM,N.PRI_FL_RELEASE_NAM,N.PRI_FL_REQUEST_QUERY_NAM,N.PRI_FL_REQUEST_STATUS_NAM,N.PRI_FL_USER_QUERY_NAM,N.PRI_FL_USER_STATUS_NAM,N.PRI_FL_QUERY_NAM,N.PRI_FL_STATUS_NAM,N.PRI_CH_ACTION_NAM,N.PRI_CH_ACTION_ACK_NAM,N.PRI_HELLO_NAM,N.PRI_HELLO_ACK_NAM,N.PRI_ERROR_NAM],I=[N.PR_LOWEST_NAM,N.PR_LOW_NAM,N.PR_NORMAL_NAM,N.PR_HIGH_NAM,N.PR_HIGHEST_NAM],c=[N.RS_PENDING_NAM,N.RS_ACCEPTED_NAM,N.RS_GRANTED_NAM,N.RS_DENIED_NAM,N.RS_CANCELLED_NAM,N.RS_RELEASED_NAM,N.RS_REVOKED_NAM],u=[N.ERR_NO_CONF_NAM,N.ERR_NO_USER_NAM,N.ERR_UNK_PR_NAM,N.ERR_UNK_ATT_NAM,N.ERR_UNAUTH_OP_NAM,N.ERR_INV_FL_ID_NAM,N.ERR_NO_FL_RQ_ID_NAM,N.ERR_MAX_FL_RQ_NAM,N.ERR_TLS_NAM],M={};M[N.ATT_BENEFICIARY_INFORMATION_NAM]=[N.ATT_BENEFICIARY_ID_NAM,N.ATT_USER_DISPLAY_NAME_NAM,N.ATT_USER_URI_NAM,N.ATT_EXTENSION_ATTRIBUTE_NAM],M[N.ATT_FLOOR_REQUEST_INFORMATION_NAM]=[N.ATT_FL_REQUEST_ID_NAM,N.ATT_OVERALL_REQUEST_STATUS_NAM,N.ATT_FL_REQUEST_STATUS_NAM,N.ATT_BENEFICIARY_INFORMATION_NAM,N.ATT_REQUESTED_BY_INFORMATION_NAM,N.ATT_PRIORITY_NAM,N.ATT_PARTICIPANT_PROVIDED_INFO_NAM,N.ATT_EXTENSION_ATTRIBUTE_NAM],M[N.ATT_REQUESTED_BY_INFORMATION_NAM]=[N.ATT_REQUESTED_BY_ID_NAM,N.ATT_USER_DISPLAY_NAME_NAM,N.ATT_USER_URI_NAM,N.ATT_EXTENSION_ATTRIBUTE_NAM],M[N.ATT_FL_REQUEST_STATUS_NAM]=[N.ATT_FL_ID_NAM,N.ATT_REQUEST_STATUS_NAM,N.ATT_STATUS_INFO_NAM,N.ATT_EXTENSION_ATTRIBUTE_NAM],M[N.ATT_OVERALL_REQUEST_STATUS_NAM]=[N.ATT_FL_REQUEST_ID_NAM,N.ATT_REQUEST_STATUS_NAM,N.ATT_STATUS_INFO_NAM,N.ATT_EXTENSION_ATTRIBUTE_NAM],M[N.ATT_REQUEST_STATUS_NAM]=[N.ATT_REQUEST_STATUS_VALUE_NAM,N.ATT_QUEUE_POSITION_NAM];var S=[N.HD_VER,N.HD_PRIMITIVE,N.HD_CONFERENCE_ID,N.HD_TRANSACTION_ID,N.HD_USER_ID,N.HD_ATTRIBUTES],l={};l[N.PRI_FL_REQUEST_NAM]={},l[N.PRI_FL_REQUEST_NAM][N.ATT_FL_ID_NAM]={},l[N.PRI_FL_REQUEST_NAM][N.ATT_FL_ID_NAM][N.CNF_OPTIONAL]=0,l[N.PRI_FL_REQUEST_NAM][N.ATT_FL_ID_NAM][N.CNF_MULTI]=1,l[N.PRI_FL_REQUEST_NAM][N.ATT_BENEFICIARY_ID_NAM]={},l[N.PRI_FL_REQUEST_NAM][N.ATT_BENEFICIARY_ID_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_FL_REQUEST_NAM][N.ATT_BENEFICIARY_ID_NAM][N.CNF_MULTI]=0,l[N.PRI_FL_REQUEST_NAM][N.ATT_PARTICIPANT_PROVIDED_INFO_NAM]={},l[N.PRI_FL_REQUEST_NAM][N.ATT_PARTICIPANT_PROVIDED_INFO_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_FL_REQUEST_NAM][N.ATT_PARTICIPANT_PROVIDED_INFO_NAM][N.CNF_MULTI]=0,l[N.PRI_FL_REQUEST_NAM][N.ATT_PRIORITY_NAM]={},l[N.PRI_FL_REQUEST_NAM][N.ATT_PRIORITY_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_FL_REQUEST_NAM][N.ATT_PRIORITY_NAM][N.CNF_MULTI]=0,l[N.PRI_FL_REQUEST_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM]={},l[N.PRI_FL_REQUEST_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_FL_REQUEST_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_MULTI]=1,l[N.PRI_FL_REQUEST_NAM]={},l[N.PRI_FL_REQUEST_NAM][N.ATT_FL_ID_NAM]={},l[N.PRI_FL_REQUEST_NAM][N.ATT_FL_ID_NAM][N.CNF_OPTIONAL]=0,l[N.PRI_FL_REQUEST_NAM][N.ATT_FL_ID_NAM][N.CNF_MULTI]=1,l[N.PRI_FL_REQUEST_NAM][N.ATT_BENEFICIARY_ID_NAM]={},l[N.PRI_FL_REQUEST_NAM][N.ATT_BENEFICIARY_ID_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_FL_REQUEST_NAM][N.ATT_BENEFICIARY_ID_NAM][N.CNF_MULTI]=0,l[N.PRI_FL_REQUEST_NAM][N.ATT_PARTICIPANT_PROVIDED_INFO_NAM]={},l[N.PRI_FL_REQUEST_NAM][N.ATT_PARTICIPANT_PROVIDED_INFO_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_FL_REQUEST_NAM][N.ATT_PARTICIPANT_PROVIDED_INFO_NAM][N.CNF_MULTI]=0,l[N.PRI_FL_REQUEST_NAM][N.ATT_PRIORITY_NAM]={},l[N.PRI_FL_REQUEST_NAM][N.ATT_PRIORITY_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_FL_REQUEST_NAM][N.ATT_PRIORITY_NAM][N.CNF_MULTI]=0,l[N.PRI_FL_REQUEST_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM]={},l[N.PRI_FL_REQUEST_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_FL_REQUEST_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_MULTI]=1,l[N.PRI_FL_RELEASE_NAM]={},l[N.PRI_FL_RELEASE_NAM][N.ATT_FL_REQUEST_ID_NAM]={},l[N.PRI_FL_RELEASE_NAM][N.ATT_FL_REQUEST_ID_NAM][N.CNF_OPTIONAL]=0,l[N.PRI_FL_RELEASE_NAM][N.ATT_FL_REQUEST_ID_NAM][N.CNF_MULTI]=0,l[N.PRI_FL_RELEASE_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM]={},l[N.PRI_FL_RELEASE_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_FL_RELEASE_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_MULTI]=1,l[N.PRI_FL_REQUEST_QUERY_NAM]={},l[N.PRI_FL_REQUEST_QUERY_NAM][N.ATT_FL_REQUEST_ID_NAM]={},l[N.PRI_FL_REQUEST_QUERY_NAM][N.ATT_FL_REQUEST_ID_NAM][N.CNF_OPTIONAL]=0,l[N.PRI_FL_REQUEST_QUERY_NAM][N.ATT_FL_REQUEST_ID_NAM][N.CNF_MULTI]=0,l[N.PRI_FL_REQUEST_QUERY_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM]={},l[N.PRI_FL_REQUEST_QUERY_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_FL_REQUEST_QUERY_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_MULTI]=1,l[N.PRI_FL_REQUEST_STATUS_NAM]={},l[N.PRI_FL_REQUEST_STATUS_NAM][N.ATT_FLOOR_REQUEST_INFORMATION_NAM]={},l[N.PRI_FL_REQUEST_STATUS_NAM][N.ATT_FLOOR_REQUEST_INFORMATION_NAM][N.CNF_OPTIONAL]=0,l[N.PRI_FL_REQUEST_STATUS_NAM][N.ATT_FLOOR_REQUEST_INFORMATION_NAM][N.CNF_MULTI]=0,l[N.PRI_FL_REQUEST_STATUS_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM]={},l[N.PRI_FL_REQUEST_STATUS_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_FL_REQUEST_STATUS_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_MULTI]=1,l[N.PRI_FL_USER_QUERY_NAM]={},l[N.PRI_FL_USER_QUERY_NAM][N.ATT_BENEFICIARY_ID_NAM]={},l[N.PRI_FL_USER_QUERY_NAM][N.ATT_BENEFICIARY_ID_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_FL_USER_QUERY_NAM][N.ATT_BENEFICIARY_ID_NAM][N.CNF_MULTI]=0,l[N.PRI_FL_USER_QUERY_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM]={},l[N.PRI_FL_USER_QUERY_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_FL_USER_QUERY_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_MULTI]=1,l[N.PRI_FL_USER_STATUS_NAM]={},l[N.PRI_FL_USER_STATUS_NAM][N.ATT_BENEFICIARY_INFORMATION_NAM]={},l[N.PRI_FL_USER_STATUS_NAM][N.ATT_BENEFICIARY_INFORMATION_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_FL_USER_STATUS_NAM][N.ATT_BENEFICIARY_INFORMATION_NAM][N.CNF_MULTI]=0,l[N.PRI_FL_USER_STATUS_NAM][N.ATT_FLOOR_REQUEST_INFORMATION_NAM]={},l[N.PRI_FL_USER_STATUS_NAM][N.ATT_FLOOR_REQUEST_INFORMATION_NAM][N.CNF_OPTIONAL]=0,l[N.PRI_FL_USER_STATUS_NAM][N.ATT_FLOOR_REQUEST_INFORMATION_NAM][N.CNF_MULTI]=1,l[N.PRI_FL_USER_STATUS_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM]={},l[N.PRI_FL_USER_STATUS_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_FL_USER_STATUS_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_MULTI]=1,l[N.PRI_FL_QUERY_NAM]={},l[N.PRI_FL_QUERY_NAM][N.ATT_FL_ID_NAM]={},l[N.PRI_FL_QUERY_NAM][N.ATT_FL_ID_NAM][N.CNF_OPTIONAL]=0,l[N.PRI_FL_QUERY_NAM][N.ATT_FL_ID_NAM][N.CNF_MULTI]=1,l[N.PRI_FL_QUERY_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM]={},l[N.PRI_FL_QUERY_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_FL_QUERY_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_MULTI]=1,l[N.PRI_FL_STATUS_NAM]={},l[N.PRI_FL_STATUS_NAM][N.ATT_FL_ID_NAM]={},l[N.PRI_FL_STATUS_NAM][N.ATT_FL_ID_NAM][N.CNF_OPTIONAL]=0,l[N.PRI_FL_STATUS_NAM][N.ATT_FL_ID_NAM][N.CNF_MULTI]=0,l[N.PRI_FL_STATUS_NAM][N.ATT_FLOOR_REQUEST_INFORMATION_NAM]={},l[N.PRI_FL_STATUS_NAM][N.ATT_FLOOR_REQUEST_INFORMATION_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_FL_STATUS_NAM][N.ATT_FLOOR_REQUEST_INFORMATION_NAM][N.CNF_MULTI]=1,l[N.PRI_FL_STATUS_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM]={},l[N.PRI_FL_STATUS_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_FL_STATUS_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_MULTI]=1,l[N.PRI_CH_ACTION_NAM]={},l[N.PRI_CH_ACTION_NAM][N.ATT_FLOOR_REQUEST_INFORMATION_NAM]={},l[N.PRI_CH_ACTION_NAM][N.ATT_FLOOR_REQUEST_INFORMATION_NAM][N.CNF_OPTIONAL]=0,l[N.PRI_CH_ACTION_NAM][N.ATT_FLOOR_REQUEST_INFORMATION_NAM][N.CNF_MULTI]=0,l[N.PRI_HELLO_NAM]={},l[N.PRI_HELLO_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM]={},l[N.PRI_HELLO_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_HELLO_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_MULTI]=1,l[N.PRI_CH_ACTION_ACK_NAM]={},l[N.PRI_CH_ACTION_ACK_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM]={},l[N.PRI_CH_ACTION_ACK_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_CH_ACTION_ACK_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_MULTI]=1,l[N.PRI_HELLO_NAM]={},l[N.PRI_HELLO_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM]={},l[N.PRI_HELLO_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_HELLO_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_MULTI]=1,l[N.PRI_HELLO_ACK_NAM]={},l[N.PRI_HELLO_ACK_NAM][N.ATT_SUPPORTED_PRIMITIVES_NAM]={},l[N.PRI_HELLO_ACK_NAM][N.ATT_SUPPORTED_PRIMITIVES_NAM][N.CNF_OPTIONAL]=0,l[N.PRI_HELLO_ACK_NAM][N.ATT_SUPPORTED_PRIMITIVES_NAM][N.CNF_MULTI]=1,l[N.PRI_HELLO_ACK_NAM][N.ATT_SUPPORTED_ATTRIBUTES_NAM]={},l[N.PRI_HELLO_ACK_NAM][N.ATT_SUPPORTED_ATTRIBUTES_NAM][N.CNF_OPTIONAL]=0,l[N.PRI_HELLO_ACK_NAM][N.ATT_SUPPORTED_ATTRIBUTES_NAM][N.CNF_MULTI]=1,l[N.PRI_HELLO_ACK_NAM][N.ATT_SUPPORTED_FLOORTYPES_NAM]={},l[N.PRI_HELLO_ACK_NAM][N.ATT_SUPPORTED_FLOORTYPES_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_HELLO_ACK_NAM][N.ATT_SUPPORTED_FLOORTYPES_NAM][N.CNF_MULTI]=1,l[N.PRI_HELLO_ACK_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM]={},l[N.PRI_HELLO_ACK_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_HELLO_ACK_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_MULTI]=1,l[N.PRI_ERROR_NAM]={},l[N.PRI_ERROR_NAM][N.ATT_ERROR_CODE_NAM]={},l[N.PRI_ERROR_NAM][N.ATT_ERROR_CODE_NAM][N.CNF_OPTIONAL]=0,l[N.PRI_ERROR_NAM][N.ATT_ERROR_CODE_NAM][N.CNF_MULTI]=0,l[N.PRI_ERROR_NAM][N.ATT_ERROR_INFO_NAM]={},l[N.PRI_ERROR_NAM][N.ATT_ERROR_INFO_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_ERROR_NAM][N.ATT_ERROR_INFO_NAM][N.CNF_MULTI]=0,l[N.PRI_ERROR_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM]={},l[N.PRI_ERROR_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_OPTIONAL]=1,l[N.PRI_ERROR_NAM][N.ATT_EXTENSION_ATTRIBUTE_NAM][N.CNF_MULTI]=1,_.prototype.getPriorityValues=function(){return I},_.prototype.getStatusValues=function(){return c},_.prototype.validatePacket=function(e){try{return this.isValidHeaderFormat(e),this.checkValidMessageFormat(e),e}catch(t){throw R("validatePacket(): invalid message format: "+JSON.stringify(e)),t}},_.prototype.createHeader=function(e,t){var _={};return _[N.HD_VER]=N.HD_VER_1,_[N.HD_PRIMITIVE]=e,_[N.HD_TRANSACTION_ID]=t,_[N.HD_CONFERENCE_ID]=this.conferenceId,_[N.HD_USER_ID]=this.userId,_[N.HD_ATTRIBUTES]={},_},_.prototype.isMine=function(e){return e[N.HD_USER_ID]===this.userId&&e[N.HD_CONFERENCE_ID]===this.conferenceId},_.prototype.isValidHeaderFormat=function(e){var t,_,r,n;for(n=Object.keys(e).length,r=0;n>r;r++)if(t=S[r],void 0===e[t])throw _="isValidHeaderFormat(): "+t+" was not founded in header: "+JSON.stringify(e),R(_),new E.InvalidHeaderFormat(_);return!0},_.prototype.checkValidMessageFormat=function(e){var t,_,n,T,o=[],A=e[N.HD_PRIMITIVE],s=JSON.stringify(e);if(a.indexOf(A)<0)throw T='checkValidMessageFormat(): message format error, primitive "'+A+"\" doesn't belong to primitives list: "+s,R(T),new E.InvalidMessageFormatPrimitive(T);var i=l[A];t=e[N.HD_ATTRIBUTES];for(var I in i)i[I][N.CNF_OPTIONAL]||t[I]||(T="checkValidMessageFormat(): message format error, no attribute "+I+": "+JSON.stringify(e),R(T),o.push(T));for(I in t)if(S.indexOf(I)<0)if(i[I])if(_=t[I],_ instanceof Array)if(i[I][N.CNF_MULTI])for(var c=_.length,u=0;c>u;u++)n=_[u],o=r(I,n,o);else T="checkValidMessageFormat(): message format error, value of "+I+" doesn't fit with the format for "+A+"(value type shouldn't be an array): "+JSON.stringify(e),R(T),o.push(T);else i[I][N.CNF_MULTI]?(T="checkValidMessageFormat(): message format error, value of "+I+" doesn't fit with the format for "+A+"(value type should be an array): "+JSON.stringify(e),R(T),o.push(T)):o=r(I,_,o);else T="checkValidMessageFormat(): message format error, attribute "+I+" doesn't belong to "+A+" specification: "+JSON.stringify(e),R(T),o.push(T);T="checkValidMessageFormat(): these errors were founded in JSON message: "+s;for(var M=0;M<o.length;M++)T+="\n- "+o[M];if(M>0)throw R(T),new E.InvalidMessageFormat(T);return!0},_.prototype.createRequestFloor=function(e,t,_,r,n){var T=this.createHeader(N.PRI_FL_REQUEST_NAM,e);return T[N.HD_ATTRIBUTES][N.ATT_FL_ID_NAM]=t,_&&_!==this.userId&&(T[N.HD_ATTRIBUTES][N.ATT_BENEFICIARY_ID_NAM]=_),r&&(T[N.HD_ATTRIBUTES][N.ATT_PRIORITY_NAM]=r),n&&(T[N.HD_ATTRIBUTES][N.ATT_PARTICIPANT_PROVIDED_INFO_NAM]=n),this.validatePacket(T)},_.prototype.createReleaseFloor=function(e,t){var _=this.createHeader(N.PRI_FL_RELEASE_NAM,e);return _[N.HD_ATTRIBUTES][N.ATT_FL_REQUEST_ID_NAM]=t,this.validatePacket(_)},_.prototype.createChairAction=function(e,t){var _=this.createHeader(N.PRI_CH_ACTION_NAM,e);return _[N.HD_ATTRIBUTES][N.ATT_FLOOR_REQUEST_INFORMATION_NAM]=t,this.validatePacket(_)},_.prototype.createQueryFloor=function(e,t){var _=this.createHeader(N.PRI_FL_QUERY_NAM,e);return _[N.HD_ATTRIBUTES][N.ATT_FL_ID_NAM]=t,this.validatePacket(_)},_.prototype.createQueryFloorRequest=function(e,t){var _=this.createHeader(N.PRI_FL_REQUEST_QUERY_NAM,e);return _[N.HD_ATTRIBUTES][N.ATT_FL_REQUEST_ID_NAM]=t,this.validatePacket(_)},_.prototype.createQueryUser=function(e,t){var _=this.createHeader(N.PRI_FL_USER_QUERY_NAM,e);return t&&(_[N.HD_ATTRIBUTES][N.ATT_BENEFICIARY_ID_NAM]=t),this.validatePacket(_)},_.prototype.createHello=function(e){var t=this.createHeader(N.PRI_HELLO_NAM,e);return this.validatePacket(t)}},{"./Exceptions":1,debug:14}],7:[function(e,t){function _(e,t,_,r){o.call(this);var n=this;this.userId=t,this.conferenceId=e,this.floorList=r,this.transactionMap={},this.floorRequestMap={},this.floorQuery=null,this.messageFactory=new A(this.userId,this.conferenceId),this.transport=new s(this.messageFactory,_),this.closed=!1,this.transport.on("connected",function(){n.emit("connected"),n.queryFloor(r)}),this.transport.on("disconnected",function(e){n.emit("disconnected",e)}),this.transport.on("response",function(e){n.manageResponse(e)}),this.transport.on("notification",function(e){n.manageNotification(e)})}t.exports=_;var r=e("debug")("JsFCP:Participant"),n=e("debug")("JsFCP:ERROR:Participant");n.log=console.warn.bind(console);var T=e("util"),o=e("events").EventEmitter,A=e("./MessageFactory"),s=e("./Transport"),i=e("./FloorRequest"),R=e("./FloorRelease"),E=e("./FloorQuery");T.inherits(_,o),_.prototype.isWebSocketReady=function(){return this.transport.isWebSocketReady()},_.prototype.manageResponse=function(e){var t=e[A.C.HD_TRANSACTION_ID];if(this.transactionMap.hasOwnProperty(t)){var _=this.transactionMap[t];delete this.transactionMap[t];var n=e[A.C.HD_PRIMITIVE];n===A.C.PRI_ERROR_NAM?_.onErrorReceived(e):_ instanceof i?_.onMessageReceived(e)===!0&&(this.floorRequestMap[_.floorRequestId]=_):_ instanceof R?this.floorRequestMap.hasOwnProperty(_.floorRequestId)&&this.manageNotification(e):_ instanceof E?_.onMessageReceived(e):r("manageResponse(): FloorRequest/FloorRelease was expected")}else r("manageResponse(): not a response, ignored")},_.prototype.manageNotification=function(e){var t=e[A.C.HD_PRIMITIVE];if(t===A.C.PRI_FL_REQUEST_STATUS_NAM){var _=e[A.C.HD_ATTRIBUTES][A.C.ATT_FLOOR_REQUEST_INFORMATION_NAM][A.C.ATT_FL_REQUEST_ID_NAM];if(this.floorRequestMap.hasOwnProperty(_)){var r=this.floorRequestMap[_];r.onMessageReceived(e)===!1&&delete this.floorRequestMap[_]}}else t===A.C.PRI_FL_STATUS_NAM&&this.floorQuery&&this.floorQuery.onMessageReceived(e)},_.prototype.requestFloor=function(e,t,_,n,T){if(r("requestFloor() | floorIds: %o",t),!Array.isArray(t)||0===t.length)throw new TypeError("pArrayFloorIds must be an array with at least one element");var o=Math.floor(1e4*Math.random());_||(_=this.userId);var A=new i(e,_);this.transactionMap[o]=A;var s=this.messageFactory.createRequestFloor(o,t,_,n,T);return this.transport.send(s),A},_.prototype.release=function(e,t){r("release() | floorRequest: %o",t);var _=null;if(_=t instanceof i?t.floorRequestId:parseInt(t),null!==_&&_!==Number.NaN){var n=Math.floor(1e4*Math.random()),T=new R(e,_,this.userId);this.transactionMap[n]=T;var o=this.messageFactory.createReleaseFloor(n,_);this.transport.send(o)}},_.prototype.queryFloor=function(e){r("queryFloor() | floorIds: %o",e);var t=this;if(e.length>0){var _=Math.floor(1e4*Math.random()),n=new E(e);this.transactionMap[_]=n,this.floorQuery=n,n.on("floorGranted",function(e){t.emit("floorGranted",e)}),n.on("floorReleased",function(e){t.emit("floorReleased",e)});var T=this.messageFactory.createQueryFloor(_,e);this.transport.send(T)}},_.prototype.close=function(){r("close()"),this.closed||this.transport.close()}},{"./FloorQuery":2,"./FloorRelease":3,"./FloorRequest":4,"./MessageFactory":6,"./Transport":8,debug:14,events:9,util:13}],8:[function(e,t){function _(e,t){r("new | uri: %s",t),o.call(this);var _=this;this.closed=!1;try{this.webSocket=new i(t),this.webSocket.onopen=function(){_.emit("connected")},this.webSocket.onmessage=function(e){_.onReceive(e)},this.webSocket.onclose=function(){_.emit("disconnected",_.closed)},this.webSocket.onerror=function(){n("WebSocket error")},this.messageFactory=e}catch(T){throw n("new | error thrown: %o",T),new s.NoWebSocketException}}t.exports=_;var r=e("debug")("JsFCP:Transport"),n=e("debug")("JsFCP:ERROR:Transport");n.log=console.warn.bind(console);var T=e("util"),o=e("events").EventEmitter,A=e("./MessageFactory"),s=e("./Exceptions"),i=e("websocket").w3cwebsocket;T.inherits(_,o),_.prototype.isWebSocketReady=function(){return this.webSocket&&this.webSocket.readyState===this.webSocket.OPEN},_.prototype.send=function(e){var t=JSON.stringify(e);if(!this.isWebSocketReady())throw new s.NoWebSocketException;this.webSocket.send(t)},_.prototype.onReceive=function(e){var t;try{t=JSON.parse(e.data)}catch(_){return void r("onReceive() | received msg is not valid JSON")}r("onReceive() | json: %o",t);try{if(this.messageFactory.isValidHeaderFormat(t),!this.messageFactory.isMine(t))return;if(this.messageFactory.checkValidMessageFormat(t)){var n=t[A.C.HD_TRANSACTION_ID];0===n?this.emit("notification",t):this.emit("response",t)}}catch(_){throw _}},_.prototype.close=function(){this.closed=!0,this.webSocket.close()}},{"./Exceptions":1,"./MessageFactory":6,debug:14,events:9,util:13,websocket:17}],9:[function(e,t){function _(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function n(e){return"number"==typeof e}function T(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}t.exports=_,_.EventEmitter=_,_.prototype._events=void 0,_.prototype._maxListeners=void 0,_.defaultMaxListeners=10,_.prototype.setMaxListeners=function(e){if(!n(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},_.prototype.emit=function(e){var t,_,n,A,s,i;if(this._events||(this._events={}),"error"===e&&(!this._events.error||T(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(_=this._events[e],o(_))return!1;if(r(_))switch(arguments.length){case 1:_.call(this);break;case 2:_.call(this,arguments[1]);break;case 3:_.call(this,arguments[1],arguments[2]);break;default:for(n=arguments.length,A=new Array(n-1),s=1;n>s;s++)A[s-1]=arguments[s];_.apply(this,A)}else if(T(_)){for(n=arguments.length,A=new Array(n-1),s=1;n>s;s++)A[s-1]=arguments[s];for(i=_.slice(),n=i.length,s=0;n>s;s++)i[s].apply(this,A)}return!0},_.prototype.addListener=function(e,t){var n;if(!r(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?T(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,T(this._events[e])&&!this._events[e].warned){var n;n=o(this._maxListeners)?_.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())
}return this},_.prototype.on=_.prototype.addListener,_.prototype.once=function(e,t){function _(){this.removeListener(e,_),n||(n=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var n=!1;return _.listener=t,this.on(e,_),this},_.prototype.removeListener=function(e,t){var _,n,o,A;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(_=this._events[e],o=_.length,n=-1,_===t||r(_.listener)&&_.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(T(_)){for(A=o;A-->0;)if(_[A]===t||_[A].listener&&_[A].listener===t){n=A;break}if(0>n)return this;1===_.length?(_.length=0,delete this._events[e]):_.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},_.prototype.removeAllListeners=function(e){var t,_;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(_=this._events[e],r(_))this.removeListener(e,_);else for(;_.length;)this.removeListener(e,_[_.length-1]);return delete this._events[e],this},_.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},_.listenerCount=function(e,t){var _;return _=e._events&&e._events[t]?r(e._events[t])?1:e._events[t].length:0}},{}],10:[function(e,t){t.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var _=function(){};_.prototype=t.prototype,e.prototype=new _,e.prototype.constructor=e}},{}],11:[function(e,t){function _(){if(!o){o=!0;for(var e,t=T.length;t;){e=T,T=[];for(var _=-1;++_<t;)e[_]();t=T.length}o=!1}}function r(){}var n=t.exports={},T=[],o=!1;n.nextTick=function(e){T.push(e),o||setTimeout(_,0)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.on=r,n.addListener=r,n.once=r,n.off=r,n.removeListener=r,n.removeAllListeners=r,n.emit=r,n.binding=function(){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],12:[function(e,t){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],13:[function(e,t,_){(function(t,r){function n(e,t){var r={seen:[],stylize:o};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),c(t)?r.showHidden=t:t&&_._extend(r,t),O(r.showHidden)&&(r.showHidden=!1),O(r.depth)&&(r.depth=2),O(r.colors)&&(r.colors=!1),O(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=T),s(r,e,r.depth)}function T(e,t){var _=n.styles[t];return _?"["+n.colors[_][0]+"m"+e+"["+n.colors[_][1]+"m":e}function o(e){return e}function A(e){var t={};return e.forEach(function(e){t[e]=!0}),t}function s(e,t,r){if(e.customInspect&&t&&p(t.inspect)&&t.inspect!==_.inspect&&(!t.constructor||t.constructor.prototype!==t)){var n=t.inspect(r,e);return l(n)||(n=s(e,n,r)),n}var T=i(e,t);if(T)return T;var o=Object.keys(t),c=A(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),d(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return R(t);if(0===o.length){if(p(t)){var u=t.name?": "+t.name:"";return e.stylize("[Function"+u+"]","special")}if(L(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(U(t))return e.stylize(Date.prototype.toString.call(t),"date");if(d(t))return R(t)}var M="",S=!1,f=["{","}"];if(I(t)&&(S=!0,f=["[","]"]),p(t)){var O=t.name?": "+t.name:"";M=" [Function"+O+"]"}if(L(t)&&(M=" "+RegExp.prototype.toString.call(t)),U(t)&&(M=" "+Date.prototype.toUTCString.call(t)),d(t)&&(M=" "+R(t)),0===o.length&&(!S||0==t.length))return f[0]+M+f[1];if(0>r)return L(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var F;return F=S?E(e,t,r,c,o):o.map(function(_){return N(e,t,r,c,_,S)}),e.seen.pop(),a(F,M,f)}function i(e,t){if(O(t))return e.stylize("undefined","undefined");if(l(t)){var _="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(_,"string")}return S(t)?e.stylize(""+t,"number"):c(t)?e.stylize(""+t,"boolean"):u(t)?e.stylize("null","null"):void 0}function R(e){return"["+Error.prototype.toString.call(e)+"]"}function E(e,t,_,r,n){for(var T=[],o=0,A=t.length;A>o;++o)T.push(g(t,String(o))?N(e,t,_,r,String(o),!0):"");return n.forEach(function(n){n.match(/^\d+$/)||T.push(N(e,t,_,r,n,!0))}),T}function N(e,t,_,r,n,T){var o,A,i;if(i=Object.getOwnPropertyDescriptor(t,n)||{value:t[n]},i.get?A=i.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):i.set&&(A=e.stylize("[Setter]","special")),g(r,n)||(o="["+n+"]"),A||(e.seen.indexOf(i.value)<0?(A=u(_)?s(e,i.value,null):s(e,i.value,_-1),A.indexOf("\n")>-1&&(A=T?A.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+A.split("\n").map(function(e){return"   "+e}).join("\n"))):A=e.stylize("[Circular]","special")),O(o)){if(T&&n.match(/^\d+$/))return A;o=JSON.stringify(""+n),o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+A}function a(e,t,_){var r=0,n=e.reduce(function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return n>60?_[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+_[1]:_[0]+t+" "+e.join(", ")+" "+_[1]}function I(e){return Array.isArray(e)}function c(e){return"boolean"==typeof e}function u(e){return null===e}function M(e){return null==e}function S(e){return"number"==typeof e}function l(e){return"string"==typeof e}function f(e){return"symbol"==typeof e}function O(e){return void 0===e}function L(e){return F(e)&&"[object RegExp]"===P(e)}function F(e){return"object"==typeof e&&null!==e}function U(e){return F(e)&&"[object Date]"===P(e)}function d(e){return F(e)&&("[object Error]"===P(e)||e instanceof Error)}function p(e){return"function"==typeof e}function h(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function P(e){return Object.prototype.toString.call(e)}function C(e){return 10>e?"0"+e.toString(10):e.toString(10)}function v(){var e=new Date,t=[C(e.getHours()),C(e.getMinutes()),C(e.getSeconds())].join(":");return[e.getDate(),b[e.getMonth()],t].join(" ")}function g(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var m=/%[sdj%]/g;_.format=function(e){if(!l(e)){for(var t=[],_=0;_<arguments.length;_++)t.push(n(arguments[_]));return t.join(" ")}for(var _=1,r=arguments,T=r.length,o=String(e).replace(m,function(e){if("%%"===e)return"%";if(_>=T)return e;switch(e){case"%s":return String(r[_++]);case"%d":return Number(r[_++]);case"%j":try{return JSON.stringify(r[_++])}catch(t){return"[Circular]"}default:return e}}),A=r[_];T>_;A=r[++_])o+=u(A)||!F(A)?" "+A:" "+n(A);return o},_.deprecate=function(e,n){function T(){if(!o){if(t.throwDeprecation)throw new Error(n);t.traceDeprecation?console.trace(n):console.error(n),o=!0}return e.apply(this,arguments)}if(O(r.process))return function(){return _.deprecate(e,n).apply(this,arguments)};if(t.noDeprecation===!0)return e;var o=!1;return T};var y,D={};_.debuglog=function(e){if(O(y)&&(y=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!D[e])if(new RegExp("\\b"+e+"\\b","i").test(y)){var r=t.pid;D[e]=function(){var t=_.format.apply(_,arguments);console.error("%s %d: %s",e,r,t)}}else D[e]=function(){};return D[e]},_.inspect=n,n.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},n.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},_.isArray=I,_.isBoolean=c,_.isNull=u,_.isNullOrUndefined=M,_.isNumber=S,_.isString=l,_.isSymbol=f,_.isUndefined=O,_.isRegExp=L,_.isObject=F,_.isDate=U,_.isError=d,_.isFunction=p,_.isPrimitive=h,_.isBuffer=e("./support/isBuffer");var b=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];_.log=function(){console.log("%s - %s",v(),_.format.apply(_,arguments))},_.inherits=e("inherits"),_._extend=function(e,t){if(!t||!F(t))return e;for(var _=Object.keys(t),r=_.length;r--;)e[_[r]]=t[_[r]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":12,_process:11,inherits:10}],14:[function(e,t,_){function r(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function n(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+_.humanize(this.diff),!t)return e;var r="color: "+this.color;e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1));var n=0,T=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(n++,"%c"===e&&(T=n))}),e.splice(T,0,r),e}function T(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function o(e){try{null==e?s.removeItem("debug"):s.debug=e}catch(t){}}function A(){var e;try{e=s.debug}catch(t){}return e}_=t.exports=e("./debug"),_.log=T,_.formatArgs=n,_.save=o,_.load=A,_.useColors=r;var s;s="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:window.localStorage,_.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],_.formatters.j=function(e){return JSON.stringify(e)},_.enable(A())},{"./debug":15}],15:[function(e,t,_){function r(){return _.colors[R++%_.colors.length]}function n(e){function t(){}function n(){var e=n,t=+new Date,T=t-(i||t);e.diff=T,e.prev=i,e.curr=t,i=t,null==e.useColors&&(e.useColors=_.useColors()),null==e.color&&e.useColors&&(e.color=r());var o=Array.prototype.slice.call(arguments);o[0]=_.coerce(o[0]),"string"!=typeof o[0]&&(o=["%o"].concat(o));var A=0;o[0]=o[0].replace(/%([a-z%])/g,function(t,r){if("%%"===t)return t;A++;var n=_.formatters[r];if("function"==typeof n){var T=o[A];t=n.call(e,T),o.splice(A,1),A--}return t}),"function"==typeof _.formatArgs&&(o=_.formatArgs.apply(e,o));var s=n.log||_.log||console.log.bind(console);s.apply(e,o)}t.enabled=!1,n.enabled=!0;var T=_.enabled(e)?n:t;return T.namespace=e,T}function T(e){_.save(e);for(var t=(e||"").split(/[\s,]+/),r=t.length,n=0;r>n;n++)t[n]&&(e=t[n].replace(/\*/g,".*?"),"-"===e[0]?_.skips.push(new RegExp("^"+e.substr(1)+"$")):_.names.push(new RegExp("^"+e+"$")))}function o(){_.enable("")}function A(e){var t,r;for(t=0,r=_.skips.length;r>t;t++)if(_.skips[t].test(e))return!1;for(t=0,r=_.names.length;r>t;t++)if(_.names[t].test(e))return!0;return!1}function s(e){return e instanceof Error?e.stack||e.message:e}_=t.exports=n,_.coerce=s,_.disable=o,_.enable=T,_.enabled=A,_.humanize=e("ms"),_.names=[],_.skips=[],_.formatters={};var i,R=0},{ms:16}],16:[function(e,t){function _(e){var t=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(e);if(t){var _=parseFloat(t[1]),r=(t[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"y":return _*R;case"days":case"day":case"d":return _*i;case"hours":case"hour":case"h":return _*s;case"minutes":case"minute":case"m":return _*A;case"seconds":case"second":case"s":return _*o;case"ms":return _}}}function r(e){return e>=i?Math.round(e/i)+"d":e>=s?Math.round(e/s)+"h":e>=A?Math.round(e/A)+"m":e>=o?Math.round(e/o)+"s":e+"ms"}function n(e){return T(e,i,"day")||T(e,s,"hour")||T(e,A,"minute")||T(e,o,"second")||e+" ms"}function T(e,t,_){return t>e?void 0:1.5*t>e?Math.floor(e/t)+" "+_:Math.ceil(e/t)+" "+_+"s"}var o=1e3,A=60*o,s=60*A,i=24*s,R=365.25*i;t.exports=function(e,t){return t=t||{},"string"==typeof e?_(e):t.long?n(e):r(e)}},{}],17:[function(e,t){function _(e,t){var _;return _=t?new n(e,t):new n(e)}var r=function(){return this}(),n=r.WebSocket||r.MozWebSocket;t.exports={w3cwebsocket:n?_:null,version:e("./version")}},{"./version":18}],18:[function(e,t){t.exports=e("../package.json").version},{"../package.json":19}],19:[function(e,t){t.exports={name:"websocket",description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],author:{name:"Brian McKelvey",email:"brian@worlize.com",url:"https://www.worlize.com/"},version:"1.0.17",repository:{type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},homepage:"https://github.com/theturtle32/WebSocket-Node",engines:{node:">=0.8.0"},dependencies:{debug:"~2.1.0",nan:"~1.0.0","typedarray-to-buffer":"~3.0.0"},devDependencies:{"buffer-equal":"0.0.1",faucet:"0.0.1",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-jshint":"^1.9.0","jshint-stylish":"^1.0.0",tape:"^3.0.0"},config:{verbose:!1},scripts:{install:"(node-gyp rebuild 2> builderror.log) || (exit 0)",test:"faucet test/unit",gulp:"gulp"},main:"index",directories:{lib:"./lib"},browser:"lib/browser.js",gitHead:"cda940b883aa884906ac13158fe514229a67f426",bugs:{url:"https://github.com/theturtle32/WebSocket-Node/issues"},_id:"websocket@1.0.17",_shasum:"8a572afc6ec120eb41473ca517d07d932f7b6a1c",_from:"websocket@>=1.0.17 <2.0.0",_npmVersion:"1.4.28",_npmUser:{name:"theturtle32",email:"brian@worlize.com"},maintainers:[{name:"theturtle32",email:"brian@worlize.com"}],dist:{shasum:"8a572afc6ec120eb41473ca517d07d932f7b6a1c",tarball:"http://registry.npmjs.org/websocket/-/websocket-1.0.17.tgz"},_resolved:"https://registry.npmjs.org/websocket/-/websocket-1.0.17.tgz",readme:"ERROR: No README data found!"}},{}]},{},[5])(5)});